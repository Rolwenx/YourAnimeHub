
<%
const title = user ? `${user.Username}'s animeList- YourAnimeHub` : 'YourAnimeHub';
%>

<%- include('../partials/header.ejs', { title: title }) %>
<link type="text/css" rel="stylesheet" href="/css/styleWatchlist.css">


<a class="cardHeader_a" href="/user/watchlist/manga">
  <div class="header_title_anime one">
    <h2 class="my_h2 text-light" style="margin-left: 20px !important;">SEE MANGA LIST</h2>
  </div>
</a>

<div class="container mt-5">


<!-- Watching Section -->
<div class="header_title_anime one">
  <h2 class="my_h2 text-light" style="margin-left: 20px !important;">WATCHING</h2>
</div>
<div class="anime-block">
  <% if (WatchingAnimeList === null || WatchingAnimeList.length === 0) { %>
    <p>No currently watching anime added yet.</p>
  <% } else { %>
    <table class="table">
      <thead>
        <tr>
          <td><strong>Title</strong></td>
          <td><strong>Rate</strong></td>
          <td><strong>Episode Progress</strong></td>
          <td><strong>Type</strong></td>
        </tr>
      </thead>
      <tbody>
        <% WatchingAnimeList.slice(0, 6).forEach((animeDetails) => { %>
          <tr class="anime-row">
            <td>
              <a href="/anime/<%= animeDetails.AnimeID%>/<%=animeDetails.TitleEnglish%>">
                <div class="anime_title_box">
                  <img src="<%= animeDetails.CoverImageURL %>" alt="<%= animeDetails.TitleEnglish %>" class="img-thumbnail" width="50">
                  <p><%= animeDetails.TitleEnglish %></p>
                </div>
              </a>
            </td>
            <td><%= animeDetails.RateGrade %></td>
            <% if (animeDetails.TypeFormat == "Movie") { %>
              <td>0/1</td>
            <% } %>
            <% if (animeDetails.TypeFormat == "TV") { %>
              <td><%= animeDetails.EpisodeProgress %> / <%= animeDetails.EpisodeCount %></td>
            <% } %>
            <td><%= animeDetails.TypeFormat %></td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } %>

</div>
<button class="view_all_btn" onclick="window.location.href='/user/watchlist/anime/watching'">View All</button>


<!-- Completed Section -->
<div class="header_title_anime one">
  <h2 class="my_h2 text-light" style="margin-left: 20px !important;">COMPLETED</h2>
</div>
<div class="anime-block">
  <% if (CompleteAnimeList === null || CompleteAnimeList.length === 0) { %>
    <p>No completed anime added yet.</p>
  <% } else { %>
    <table class="table">
      <thead>
        <tr>
          <td><strong>Title</strong></td>
          <td><strong>Rate</strong></td>
          <td><strong>Episode Progress</strong></td>
          <td><strong>Type</strong></td>
        </tr>
      </thead>
      <tbody>
        <% CompleteAnimeList.slice(0, 6).forEach((animeDetails) => { %>
          <tr class="anime-row">
            <td>
              <a href="/anime/<%= animeDetails.AnimeID%>/<%=animeDetails.TitleEnglish%>">
                <div class="anime_title_box">
                  <img src="<%= animeDetails.CoverImageURL %>" alt="<%= animeDetails.TitleEnglish %>" class="img-thumbnail" width="50">
                  <p><%= animeDetails.TitleEnglish %></p>
                </div>
              </a>
            </td>
            <td><%= animeDetails.RateGrade %></td>
            <% if (animeDetails.TypeFormat == "Movie") { %>
              <td>0/1</td>
            <% } %>
            <% if (animeDetails.TypeFormat == "TV") { %>
              <td><%= animeDetails.EpisodeProgress %> / <%= animeDetails.EpisodeCount %></td>
            <% } %>
            <td><%= animeDetails.TypeFormat %></td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } %>

  </div>
  <button class="view_all_btn" onclick="window.location.href='/user/watchlist/anime/complete'">View All</button>
  
  
  

<!-- Planning Section -->
<div class="header_title_anime one">
  <h2 class="my_h2 text-light" style="margin-left: 20px !important;">PLANNING</h2>
</div>
<div class="anime-block">
  <% if (PlanningAnimeList === null || PlanningAnimeList.length === 0) { %>
    <p>No planned to watch anime added yet.</p>
  <% } else { %>
    <table class="table">
      <thead>
        <tr>
          <td><strong>Title</strong></td>
          <td><strong>Rate</strong></td>
          <td><strong>Episode Progress</strong></td>
          <td><strong>Type</strong></td>
        </tr>
      </thead>
      <tbody>
        <% PlanningAnimeList.slice(0, 6).forEach((animeDetails) => { %>
          <tr class="anime-row">
            <td>
              <a href="/anime/<%= animeDetails.AnimeID%>/<%=animeDetails.TitleEnglish%>">
                <div class="anime_title_box">
                  <img src="<%= animeDetails.CoverImageURL %>" alt="<%= animeDetails.TitleEnglish %>" class="img-thumbnail" width="50">
                  <p><%= animeDetails.TitleEnglish %></p>
                </div>
              </a>
            </td>
            <td><%= animeDetails.RateGrade %></td>
            <% if (animeDetails.TypeFormat == "Movie") { %>
              <td>0/1</td>
            <% } %>
            <% if (animeDetails.TypeFormat == "TV") { %>
              <td><%= animeDetails.EpisodeProgress %> / <%= animeDetails.EpisodeCount %></td>
            <% } %>
            <td><%= animeDetails.TypeFormat %></td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } %>
  </div>
  <button class="view_all_btn" onclick="window.location.href='/user/watchlist/anime/planning'">View All</button>


  <% if (RewatchedAnimeList !== null) { %>
  <!-- Rewatching Section -->
  <div class="header_title_anime one">
    <h2 class="my_h2 text-light" style="margin-left: 20px !important;">REWATCHING</h2>
  </div>
  <div class="anime-block">
      <table class="table">
        <thead>
          <tr>
            <td><strong>Title</strong></td>
            <td><strong>Rate</strong></td>
            <td><strong>Episode Progress</strong></td>
            <td><strong>Type</strong></td>
          </tr>
        </thead>
        <tbody>
          <% RewatchedAnimeList.slice(0, 6).forEach((animeDetails) => { %>
            <tr class="anime-row">
              <td>
                <a href="/anime/<%= animeDetails.AnimeID%>/<%=animeDetails.TitleEnglish%>">
                  <div class="anime_title_box">
                    <img src="<%= animeDetails.CoverImageURL %>" alt="<%= animeDetails.TitleEnglish %>" class="img-thumbnail" width="50">
                    <p><%= animeDetails.TitleEnglish %></p>
                  </div>
                </a>
              </td>
              <td><%= animeDetails.RateGrade %></td>
              <% if (animeDetails.TypeFormat == "Movie") { %>
                <td>0/1</td>
              <% } %>
              <% if (animeDetails.TypeFormat == "TV") { %>
                <td><%= animeDetails.EpisodeProgress %> / <%= animeDetails.EpisodeCount %></td>
              <% } %>
              <td><%= animeDetails.TypeFormat %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
  </div>
  <button class="view_all_btn" id="load-more-button">Load More</button>
  <% } %>


  <% if (PausedAnimeList !== null) { %>
  <!-- Paused Section -->
  <div class="header_title_anime one">
    <h2 class="my_h2 text-light" style="margin-left: 20px !important;">PAUSED</h2>
  </div>
  <div class="anime-block">
      <table class="table">
        <thead>
          <tr>
            <td><strong>Title</strong></td>
            <td><strong>Rate</strong></td>
            <td><strong>Episode Progress</strong></td>
            <td><strong>Type</strong></td>
          </tr>
        </thead>
        <tbody>
          <% PausedAnimeList.slice(0, 6).forEach((animeDetails) => { %>
            <tr class="anime-row">
              <td>
                <a href="/anime/<%= animeDetails.AnimeID%>/<%=animeDetails.TitleEnglish%>">
                  <div class="anime_title_box">
                    <img src="<%= animeDetails.CoverImageURL %>" alt="<%= animeDetails.TitleEnglish %>" class="img-thumbnail" width="50">
                    <p><%= animeDetails.TitleEnglish %></p>
                  </div>
                </a>
              </td>
              <td><%= animeDetails.RateGrade %></td>
              <% if (animeDetails.TypeFormat == "Movie") { %>
                <td>0/1</td>
              <% } %>
              <% if (animeDetails.TypeFormat == "TV") { %>
                <td><%= animeDetails.EpisodeProgress %> / <%= animeDetails.EpisodeCount %></td>
              <% } %>
              <td><%= animeDetails.TypeFormat %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
  </div>
  <button class="view_all_btn" id="load-more-button">Load More</button>
  <% } %>


  <% if (DroppedAnimeList !== null) { %>
  <!-- Dropped Section -->
  <div class="header_title_anime one">
    <h2 class="my_h2 text-light" style="margin-left: 20px !important;">DROPPED</h2>
  </div>
  <div class="anime-block">
      <table class="table">
        <thead>
          <tr>
            <td><strong>Title</strong></td>
            <td><strong>Rate</strong></td>
            <td><strong>Episode Progress</strong></td>
            <td><strong>Type</strong></td>
          </tr>
        </thead>
        <tbody>
          <% DroppedAnimeList.slice(0, 6).forEach((animeDetails) => { %>
            <tr class="anime-row">
              <td>
                <a href="/anime/<%= animeDetails.AnimeID%>/<%=animeDetails.TitleEnglish%>">
                  <div class="anime_title_box">
                    <img src="<%= animeDetails.CoverImageURL %>" alt="<%= animeDetails.TitleEnglish %>" class="img-thumbnail" width="50">
                    <p><%= animeDetails.TitleEnglish %></p>
                  </div>
                </a>
              </td>
              <td><%= animeDetails.RateGrade %></td>
              <% if (animeDetails.TypeFormat == "Movie") { %>
                <td>0/1</td>
              <% } %>
              <% if (animeDetails.TypeFormat == "TV") { %>
                <td><%= animeDetails.EpisodeProgress %> / <%= animeDetails.EpisodeCount %></td>
              <% } %>
              <td><%= animeDetails.TypeFormat %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
  </div>
  <button class="view_all_btn" id="load-more-button">Load More</button>
  <% } %>
  


</div>


<%- include('../partials/footer.ejs', { title: title }) %>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    let displayedCharCount = 10;

    const animeTable = document.getElementById("anime-table");
    const animeRows = document.querySelectorAll(".anime-row");

    // Initially hide rows greater than 10
    animeRows.forEach((row, index) => {
      if (index >= displayedCharCount) {
        row.style.display = "none";
      }
    });

    document.getElementById("load-more-button").addEventListener("click", function () {
      for (let i = displayedCharCount; i < displayedCharCount + 10; i++) {
        if (i < animeRows.length) {
          animeRows[i].style.display = "table-row";
        }
      }

      displayedCharCount += 10;

      // Hide load more button if all anime are displayed
      if (displayedCharCount >= animeRows.length) {
        document.getElementById("load-more-button").style.display = "none";
      }
    });
  });
</script>

</body>
</html>